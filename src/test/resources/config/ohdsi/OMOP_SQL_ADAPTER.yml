id: OMOP_SQL_Adapter
adapter: care.smith.top.top_phenotypic_query.adapter.sql.SQLAdapter
connection:
  url: jdbc:postgresql://localhost:9024/ohdsi
  user: postgres
  password: postgres
subjectQuery:
  baseQuery: "SELECT iq.person_id as person_id, iq.birth_date as birth_date, iq.gender_concept_id as gender_concept_id FROM( SELECT person_id, make_date ( year_of_birth, month_of_birth, day_of_birth) AS birth_date, gender_concept_id FROM synpuf_cdm.person) AS iq \nWHERE TRUE"
  sexListPart: "\nAND gender_concept_id IN ({values})"
  birthdateIntervalPart: "\nAND birth_date {operator} {value}"
  output:
    id: person_id
    sex: gender_concept_id
    birthdate: birth_date
phenotypeQueries:
  encounter:
    baseQuery: "SELECT visit_occurrence_id, visit_start_date, visit_end_date, concept_code FROM synpuf_cdm.visit_occurrence, synpuf_cdm.concept\nWHERE TRUE"
    textValueListPart: "\nAND visit_concept_id = concept_id AND concept_code IN ({values})"
    startDateTimeIntervalPart: "\nAND visit_start_date {operator} {value}"
    endDateTimeIntervalPart: "\nAND (visit_end_date IS NULL OR visit_end_date {operator} {value})"
    output:
      subject: visit_occurrence_id
      textValue: concept_code
      startDateTime: visit_start_date
      endDateTime: visit_end_date
  observation:
    baseQuery: "SELECT visit_occurrence_id, observation_date, value_as_number FROM synpuf_cdm.observation, synpuf_cdm.concept\nWHERE concept_id = observation_concept_id and concept_code in (select SPLIT_PART(code, '|', 2) from UNNEST(array[ {codes} ]) as code)"
    numberValueIntervalPart: "\nAND value_as_number {operator} {value}"
    numberValueListPart: "\nAND value_as_number IN ({values})"
    dateTimeIntervalPart: "\nAND observation_date {operator} {value}"
    output:
      subject: visit_occurrence_id
      numberValue: value_as_number
      dateTime: observation_date
  condition:
    baseQuery: "SELECT person_id, condition_start_date, condition_end_date FROM synpuf_cdm.condition_occurrence, synpuf_cdm.concept\nWHERE concept_id = condition_concept_id and concept_code in (select SPLIT_PART(code, '|', 2) from UNNEST(array[ {codes} ]) as code)"
    startDateTimeIntervalPart: "\nAND condition_start_date {operator} {value}"
    endDateTimeIntervalPart: "\nAND condition_end_date {operator} {value}"
    subjectsPart: "\nAND person_id IN ({values})"
    output:
      subject: person_id
      dateTime: condition_start_datetime
  medication:
    baseQuery: "SELECT person_id, drug_exposure_start_datetime, drug_exposure_end_datetime FROM synpuf_cdm.drug_exposure, synpuf_cdm.concept\nWHERE concept_id = drug_concept_id and concept_code in (select SPLIT_PART(code, '|', 2) from UNNEST(array[ {codes} ]) as code)"
    startDateTimeIntervalPart: "\nAND drug_exposure_start_datetime {operator} {value}"
    endDateTimeIntervalPart: "\nAND drug_exposure_end_datetime {operator} {value}"
    subjectsPart: "\nAND person_id IN ({values})"
    output:
      subject: person_id
      dateTime: drug_exposure_start_datetime
  procedure:
    baseQuery: "SELECT visit_occurrence_id, procedure_datetime FROM synpuf_cdm.procedure_occurrence, synpuf_cdm.concept\nWHERE concept_id = procedure_concept_id and concept_code in (select SPLIT_PART(code, '|', 2) from UNNEST(array[ {codes} ]) as code)"
    dateTimeIntervalPart: "\nAND procedure_datetime {operator} {value}"
    subjectsPart: "\nAND visit_occurrence_id IN ({values})"
    output:
      subject: visit_occurrence_id
      dateTime: procedure_datetime
birthdateMapping:
  code: http://loinc.org|21112-8
ageMapping:
  code: http://loinc.org|30525-0
sexMapping:
  code: http://snomed.info/sct|263495000
  restrictionMappings:
    - model: [ http://snomed.info/sct|248153007 ]
      source: [ 8507 ]
    - model: [ Male ]
      source: [ 8507 ]
    - model: [ http://snomed.info/sct|248152002 ]
      source: [ 8532 ]
    - model: [ Female ]
      source: [ 8532 ]
codeMappings:
  - code: http://snomed.info/sct|308335008
    type: encounter
    restrictionMappings:
      - model: [ IMP ]
        source: [ IP ]
      - model: [ AMB ]
        source: [ OP ]
