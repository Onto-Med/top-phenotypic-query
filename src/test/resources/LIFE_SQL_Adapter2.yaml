id: LIFE_SQL_Adapter
connection:
  driver: org.postgresql.Driver
  url: jdbc:postgresql://server/database
  user: user1
  password: password1
valueSeparator: ", "
operEQ: "="
operGT: ">"
operGE: ">="
operLT: "<"
operLE: "<="
subjectQuery: 
  baseQuery: "SELECT p.id, b.gender, b.birthdate FROM Patient p, Basic_Properties b WHERE b.pat_id = p.id 
  baseQueryOnlyId: "SELECT p.id FROM Patient p WHERE TRUE"
  baseQueryOnlyCount: "SELECT count(p.id) FROM Patient p WHERE TRUE"
  paramGender: " AND (SELECT gender FROM Basic_Properties WHERE pat_id = p.id) IN ({gender})"
  paramBirthdate: " AND (SELECT birthdate FROM Basic_Properties WHERE pat_id = p.id) {operator} '{birthdate}'::date"
  paramId: " AND p.id IN ({id})"    
  output:
    id: p.id
    gender: b.gender
    birthdate: b.birthdate
propertyQueries:
  - type: Assessment1
    baseQuery: "SELECT pat_id, {prop}, recorded_date FROM Assessment1 WHERE TRUE"
    baseQueryOnlyCount: "SELECT count({prop}) FROM Assessment1 WHERE TRUE"
    baseQueryOnlySubject: "SELECT DISTINCT pat_id FROM Assessment1 WHERE {prop} IS NOT NULL"
    paramId: " AND id IN ({id})"
    paramSubject: " AND pat_id IN ({subject})"
    paramDate: " AND recorded_date {operator} '{date}'::date"
    paramSubjectHasProp: " AND EXISTS (SELECT a.{prop} FROM Assessment1 a WHERE a.pat_id = Patient.id AND a.{prop} IS NOT NULL)"
    paramValueQuantity: " AND {prop} {operator} {value}"
    paramValueText: " AND {prop} {operator} '{value}'"
    paramFirstRecord: " ORDER BY recorded_date LIMIT 1"
    paramLastRecord: " ORDER BY recorded_date DESC LIMIT 1"
    output:
      subject: pat_id
      prop: {prop}
      date: recorded_date
  - type: Assessment2
    baseQuery: "SELECT a.pat_id, a.prop_val, a.recorded_date FROM Assessment2 a, Property p WHERE p.id = a.prop_id AND p.name IN ({prop})"
    baseQueryOnlyCount: "SELECT count(a.prop_val) FROM Assessment2 a, Property p WHERE p.id = a.prop_id AND p.name IN ({prop})"
    baseQueryOnlySubject: "SELECT DISTINCT a.pat_id FROM Assessment2 a, Property p WHERE p.id = a.prop_id AND p.name IN ({prop})"
    paramId: " AND p.id IN ({id})"
    paramSubject: " AND a.pat_id IN ({subject})"
    paramDate: " AND a.recorded_date {operator} '{date}'::date"
    paramSubjectHasProp: " AND EXISTS (SELECT a.prop_val FROM Assessment2 a, Property p WHERE p.id = a.prop_id AND p.name IN ({prop}) AND a.prop_val IS NOT NULL)"
    paramValueQuantity: " AND {prop} {operator} {value}"
    paramValueText: " AND {prop} {operator} '{value}'"
    paramFirstRecord: " ORDER BY recorded_date LIMIT 1"
    paramLastRecord: " ORDER BY recorded_date DESC LIMIT 1"
    output:
      subject: patientId